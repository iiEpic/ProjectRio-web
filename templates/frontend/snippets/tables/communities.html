<table class="table table-hover" id="communities_table">
    <thead>
        <tr>
            <th scope="col" class="ps-3">Name
                <i class="bi bi-funnel filter-icon"></i>
                <div class="filter-box">
                    <input type="text" class="form-control filter-input" placeholder="Filter by name">
                </div>
            </th>
            <th scope="col">Date Created
                <i class="bi bi-funnel filter-icon"></i>
                <div class="filter-box">
                    <input type="text" class="form-control filter-input" placeholder="Filter by date">
                </div>
            </th>
            <th scope="col">Description
                <i class="bi bi-funnel filter-icon"></i>
                <div class="filter-box">
                    <input type="text" class="form-control filter-input" placeholder="Filter by description">
                </div>
            </th>
            <th scope="col">Private
                <i class="bi bi-funnel filter-icon"></i>
                <div class="filter-box">
                    <input type="text" class="form-control filter-input" placeholder="Filter by status">
                </div>
            </th>
            <th scope="col">Tag Set Limit</th>
            <th scope="col">Type
                <i class="bi bi-funnel filter-icon"></i>
                <div class="filter-box">
                    <input type="text" class="form-control filter-input" placeholder="Filter by type">
                </div>
            </th>
            <th scope="col">URL</th>
        </tr>
    </thead>
    <tbody id="table-body-communities">
        {% for community in communities %}
        <tr>
            <td scope="row" class="ps-3 col-md-2">
                <a href="{% url 'frontend:communities' community.name %}" class="link-dark">{{ community.name }}</a>
                {% if community.sponsor is None %}<span class="badge rounded-pill text-bg-warning">Unsponsored</span>{% endif %}
            </td>
            <td class="col-md-2">{{ community.date_created }}</td>
            <td class="col-md-2">{{ community.description }}</td>
            <td class="col-md-1">{{ community.private }}</td>
            <td class="col-md-2">{{ community.active_tag_set_limit }}</td>
            <td class="col-md-1">{{ community.community_type }}</td>
            <td class="col-md-4">{{ community.active_url }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let activeFilterBox = null;

        // Function to initialize filtering for a specific table
        function initializeTableFiltering(tableBodyId) {
            const tableBody = document.getElementById(tableBodyId);
            const filterIcons = tableBody.closest('table').querySelectorAll('.filter-icon');

            filterIcons.forEach((icon, index) => {
                icon.addEventListener('click', function (event) {
                    const filterBox = icon.nextElementSibling;

                    if (activeFilterBox && activeFilterBox !== filterBox) {
                        activeFilterBox.style.display = 'none';
                    }

                    filterBox.style.display = filterBox.style.display === 'block' ? 'none' : 'block';
                    activeFilterBox = filterBox.style.display === 'block' ? filterBox : null;

                    event.stopPropagation(); // Prevents the document click listener from immediately hiding the box
                });
            });

            // Prevent the filter box from hiding when clicking inside it
            const filterBoxes = tableBody.closest('table').querySelectorAll('.filter-box');
            filterBoxes.forEach((box) => {
                box.addEventListener('click', function (event) {
                    event.stopPropagation(); // Prevent click inside filter box from hiding it
                });
            });

            // Filter function
            const filterInputs = tableBody.closest('table').querySelectorAll('.filter-input');
            filterInputs.forEach((input, index) => {
                input.addEventListener('input', function () {
                    const filterValue = input.value.toLowerCase();
                    const rows = tableBody.getElementsByTagName('tr');

                    Array.from(rows).forEach(row => {
                        const cell = row.getElementsByTagName('td')[index];
                        if (cell) {
                            const cellText = cell.textContent.toLowerCase();
                            row.style.display = cellText.includes(filterValue) ? '' : 'none';
                        }
                    });
                });
            });
        }

        // Hide active filter box when clicking outside
        document.addEventListener('click', function () {
            if (activeFilterBox) {
                activeFilterBox.style.display = 'none';
                activeFilterBox = null;
            }
        });

        // Initialize filtering for all tables
        initializeTableFiltering('table-body-communities');
    });
</script>